load_file("nrngui.hoc") 

create soma
access soma

gNaBar=0.012
gKBar=0.04
//ghdBar = 0.0001
ghdBar = 0.000001
RM = 35000

//Soma dimensions
soma nseg = 1
soma diam = 20
soma L = 20
soma Ra = 123.0
soma Rm = RM



// Insert channels
soma insert na3
soma insert kdr
insert pas
insert hd
g_pas = 1/RM
e_pas = -65.0
gbar_na3=gNaBar
gkdrbar_kdr=gKBar
ek_kdr = -90
ena_na3 = 55
ghdbar_hd = ghdBar


v_init = -65
stamp = 0.1
Duration = 0.1

objectvar stim
soma stim = new IClamp(0.5)

stim.del = 100
stim.dur = Duration
stim.amp = stamp

tstop = 200


// Panel buttons and procedures:

proc update_gNaBar() {
	gbar_na3=gNaBar
}

proc update_gKBar() {
	gkdrbar_kdr=gKBar
}

proc update_ghdBar() {
	ghdbar_hd=ghdBar
}


objref SpikeCounter, nil, spiketimes, fr, Istim
SpikeCounter = new NetCon(&soma.v(0.5), nil)
SpikeCounter.threshold = -15  //mV
spiketimes = new Vector()
fr = new Vector()
Istim = new Vector()

objref fi
fi = new File()
fi.wopen("FI2.dat")

// Define:
proc get_firingRate() {
    SpikeCounter.record(spiketimes)
    numspikes = spiketimes.size()
    FR = numspikes/stim.dur
    fi.aopen("FI3.dat")
    fi.printf("%f\n",FR)
    fr.append(FR)
}

currstep = 0.05 //nA
numamps = 50

proc get_fiVsAmp() {
/// For getting FI curve vs Current amplitude:
    
    for (k = currstep; k<=numamps*currstep; k+=currstep) {


        // Run simulation
	//print k
	finitialize(v_init)
	fcurrent()
	soma stim.amp = k
	fi.printf("%f\t", k)
	run()
        // Get num of spikes
        get_firingRate()
	i+=1
    }
}

get_fiVsAmp()

xpanel("Parameters")
xvalue("gNaBar","gNaBar",1,"update_gNaBar()",1,1)
xvalue("gKBar","gKBar",1,"update_gKBar()",1,1)
xvalue("ghBar","ghdBar",1,"update_ghdBar()",1,1)
xpanel()

newPlotV()

fi.close()

nrncontrolmenu()
//xopen("class3.ses")
